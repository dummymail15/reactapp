{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/home/ravi/coinflip/coin-flip-test-main/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/home/ravi/coinflip/coin-flip-test-main/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _classCallCheck = require(\"/home/ravi/coinflip/coin-flip-test-main/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/home/ravi/coinflip/coin-flip-test-main/node_modules/@babel/runtime/helpers/createClass\");\n\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\n\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\n\nvar _FallbackHandlerManager_ethAdapter, _FallbackHandlerManager_safeContract, _FallbackHandlerManager_slot;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar utils_1 = require(\"../utils\");\n\nvar constants_1 = require(\"../utils/constants\");\n\nvar safeVersions_1 = require(\"../utils/safeVersions\");\n\nvar FallbackHandlerManager = /*#__PURE__*/function () {\n  function FallbackHandlerManager(ethAdapter, safeContract) {\n    _classCallCheck(this, FallbackHandlerManager);\n\n    _FallbackHandlerManager_ethAdapter.set(this, void 0);\n\n    _FallbackHandlerManager_safeContract.set(this, void 0); // keccak256(\"fallback_manager.handler.address\")\n\n\n    _FallbackHandlerManager_slot.set(this, '0x6c9a6c4a39284e37ed1cf53d337577d14212a4870fb976a4366c693b939918d5');\n\n    __classPrivateFieldSet(this, _FallbackHandlerManager_ethAdapter, ethAdapter, \"f\");\n\n    __classPrivateFieldSet(this, _FallbackHandlerManager_safeContract, safeContract, \"f\");\n  }\n\n  _createClass(FallbackHandlerManager, [{\n    key: \"validateFallbackHandlerAddress\",\n    value: function validateFallbackHandlerAddress(fallbackHandlerAddress) {\n      var isValidAddress = __classPrivateFieldGet(this, _FallbackHandlerManager_ethAdapter, \"f\").isAddress(fallbackHandlerAddress);\n\n      if (!isValidAddress || (0, utils_1.isZeroAddress)(fallbackHandlerAddress)) {\n        throw new Error('Invalid fallback handler address provided');\n      }\n    }\n  }, {\n    key: \"validateFallbackHandlerIsNotEnabled\",\n    value: function validateFallbackHandlerIsNotEnabled(currentFallbackHandler, newFallbackHandlerAddress) {\n      if ((0, utils_1.sameString)(currentFallbackHandler, newFallbackHandlerAddress)) {\n        throw new Error('Fallback handler provided is already enabled');\n      }\n    }\n  }, {\n    key: \"validateFallbackHandlerIsEnabled\",\n    value: function validateFallbackHandlerIsEnabled(fallbackHandlerAddress) {\n      if ((0, utils_1.isZeroAddress)(fallbackHandlerAddress)) {\n        throw new Error('There is no fallback handler enabled yet');\n      }\n    }\n  }, {\n    key: \"getFallbackHandler\",\n    value: function () {\n      var _getFallbackHandler = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var safeVersion;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return __classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").getVersion();\n\n              case 2:\n                safeVersion = _context.sent;\n\n                if (!(0, safeVersions_1.hasFeature)(safeVersions_1.FEATURES.SAFE_FALLBACK_HANDLER, safeVersion)) {\n                  _context.next = 7;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", __classPrivateFieldGet(this, _FallbackHandlerManager_ethAdapter, \"f\").getStorageAt(__classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").getAddress(), __classPrivateFieldGet(this, _FallbackHandlerManager_slot, \"f\")));\n\n              case 7:\n                throw new Error('Current version of the Safe does not support the fallback handler functionality');\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getFallbackHandler() {\n        return _getFallbackHandler.apply(this, arguments);\n      }\n\n      return getFallbackHandler;\n    }()\n  }, {\n    key: \"encodeEnableFallbackHandlerData\",\n    value: function () {\n      var _encodeEnableFallbackHandlerData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(fallbackHandlerAddress) {\n        var currentFallbackHandler;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.validateFallbackHandlerAddress(fallbackHandlerAddress);\n                _context2.next = 3;\n                return this.getFallbackHandler();\n\n              case 3:\n                currentFallbackHandler = _context2.sent;\n                this.validateFallbackHandlerIsNotEnabled(currentFallbackHandler, fallbackHandlerAddress);\n                return _context2.abrupt(\"return\", __classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").encode('setFallbackHandler', [fallbackHandlerAddress]));\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function encodeEnableFallbackHandlerData(_x) {\n        return _encodeEnableFallbackHandlerData.apply(this, arguments);\n      }\n\n      return encodeEnableFallbackHandlerData;\n    }()\n  }, {\n    key: \"encodeDisableFallbackHandlerData\",\n    value: function () {\n      var _encodeDisableFallbackHandlerData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var currentFallbackHandler;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return this.getFallbackHandler();\n\n              case 2:\n                currentFallbackHandler = _context3.sent;\n                this.validateFallbackHandlerIsEnabled(currentFallbackHandler);\n                return _context3.abrupt(\"return\", __classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").encode('setFallbackHandler', [constants_1.ZERO_ADDRESS]));\n\n              case 5:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function encodeDisableFallbackHandlerData() {\n        return _encodeDisableFallbackHandlerData.apply(this, arguments);\n      }\n\n      return encodeDisableFallbackHandlerData;\n    }()\n  }]);\n\n  return FallbackHandlerManager;\n}();\n\n_FallbackHandlerManager_ethAdapter = new WeakMap(), _FallbackHandlerManager_safeContract = new WeakMap(), _FallbackHandlerManager_slot = new WeakMap();\nexports.default = FallbackHandlerManager;","map":{"version":3,"sources":["../../../src/managers/fallbackHandlerManager.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _FallbackHandlerManager_ethAdapter, _FallbackHandlerManager_safeContract, _FallbackHandlerManager_slot;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst utils_1 = require(\"../utils\");\nconst constants_1 = require(\"../utils/constants\");\nconst safeVersions_1 = require(\"../utils/safeVersions\");\nclass FallbackHandlerManager {\n    constructor(ethAdapter, safeContract) {\n        _FallbackHandlerManager_ethAdapter.set(this, void 0);\n        _FallbackHandlerManager_safeContract.set(this, void 0);\n        // keccak256(\"fallback_manager.handler.address\")\n        _FallbackHandlerManager_slot.set(this, '0x6c9a6c4a39284e37ed1cf53d337577d14212a4870fb976a4366c693b939918d5');\n        __classPrivateFieldSet(this, _FallbackHandlerManager_ethAdapter, ethAdapter, \"f\");\n        __classPrivateFieldSet(this, _FallbackHandlerManager_safeContract, safeContract, \"f\");\n    }\n    validateFallbackHandlerAddress(fallbackHandlerAddress) {\n        const isValidAddress = __classPrivateFieldGet(this, _FallbackHandlerManager_ethAdapter, \"f\").isAddress(fallbackHandlerAddress);\n        if (!isValidAddress || (0, utils_1.isZeroAddress)(fallbackHandlerAddress)) {\n            throw new Error('Invalid fallback handler address provided');\n        }\n    }\n    validateFallbackHandlerIsNotEnabled(currentFallbackHandler, newFallbackHandlerAddress) {\n        if ((0, utils_1.sameString)(currentFallbackHandler, newFallbackHandlerAddress)) {\n            throw new Error('Fallback handler provided is already enabled');\n        }\n    }\n    validateFallbackHandlerIsEnabled(fallbackHandlerAddress) {\n        if ((0, utils_1.isZeroAddress)(fallbackHandlerAddress)) {\n            throw new Error('There is no fallback handler enabled yet');\n        }\n    }\n    async getFallbackHandler() {\n        const safeVersion = await __classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").getVersion();\n        if ((0, safeVersions_1.hasFeature)(safeVersions_1.FEATURES.SAFE_FALLBACK_HANDLER, safeVersion)) {\n            return __classPrivateFieldGet(this, _FallbackHandlerManager_ethAdapter, \"f\").getStorageAt(__classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").getAddress(), __classPrivateFieldGet(this, _FallbackHandlerManager_slot, \"f\"));\n        }\n        else {\n            throw new Error('Current version of the Safe does not support the fallback handler functionality');\n        }\n    }\n    async encodeEnableFallbackHandlerData(fallbackHandlerAddress) {\n        this.validateFallbackHandlerAddress(fallbackHandlerAddress);\n        const currentFallbackHandler = await this.getFallbackHandler();\n        this.validateFallbackHandlerIsNotEnabled(currentFallbackHandler, fallbackHandlerAddress);\n        return __classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").encode('setFallbackHandler', [fallbackHandlerAddress]);\n    }\n    async encodeDisableFallbackHandlerData() {\n        const currentFallbackHandler = await this.getFallbackHandler();\n        this.validateFallbackHandlerIsEnabled(currentFallbackHandler);\n        return __classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").encode('setFallbackHandler', [constants_1.ZERO_ADDRESS]);\n    }\n}\n_FallbackHandlerManager_ethAdapter = new WeakMap(), _FallbackHandlerManager_safeContract = new WeakMap(), _FallbackHandlerManager_slot = new WeakMap();\nexports.default = FallbackHandlerManager;\n//# sourceMappingURL=fallbackHandlerManager.js.map"]},"metadata":{},"sourceType":"script"}