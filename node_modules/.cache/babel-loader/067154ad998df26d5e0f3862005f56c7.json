{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/home/ravi/coinflip/coin-flip-test-main/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/home/ravi/coinflip/coin-flip-test-main/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _classCallCheck = require(\"/home/ravi/coinflip/coin-flip-test-main/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/home/ravi/coinflip/coin-flip-test-main/node_modules/@babel/runtime/helpers/createClass\");\n\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\n\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\n\nvar _GuardManager_ethAdapter, _GuardManager_safeContract, _GuardManager_slot;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar utils_1 = require(\"../utils\");\n\nvar constants_1 = require(\"../utils/constants\");\n\nvar safeVersions_1 = require(\"../utils/safeVersions\");\n\nvar GuardManager = /*#__PURE__*/function () {\n  function GuardManager(ethAdapter, safeContract) {\n    _classCallCheck(this, GuardManager);\n\n    _GuardManager_ethAdapter.set(this, void 0);\n\n    _GuardManager_safeContract.set(this, void 0); // keccak256(\"guard_manager.guard.address\")\n\n\n    _GuardManager_slot.set(this, '0x4a204f620c8c5ccdca3fd54d003badd85ba500436a431f0cbda4f558c93c34c8');\n\n    __classPrivateFieldSet(this, _GuardManager_ethAdapter, ethAdapter, \"f\");\n\n    __classPrivateFieldSet(this, _GuardManager_safeContract, safeContract, \"f\");\n  }\n\n  _createClass(GuardManager, [{\n    key: \"validateGuardAddress\",\n    value: function validateGuardAddress(guardAddress) {\n      var isValidAddress = __classPrivateFieldGet(this, _GuardManager_ethAdapter, \"f\").isAddress(guardAddress);\n\n      if (!isValidAddress || (0, utils_1.isZeroAddress)(guardAddress)) {\n        throw new Error('Invalid guard address provided');\n      }\n    }\n  }, {\n    key: \"validateGuardIsNotEnabled\",\n    value: function validateGuardIsNotEnabled(currentGuard, newGuardAddress) {\n      if ((0, utils_1.sameString)(currentGuard, newGuardAddress)) {\n        throw new Error('Guard provided is already enabled');\n      }\n    }\n  }, {\n    key: \"validateGuardIsEnabled\",\n    value: function validateGuardIsEnabled(guardAddress) {\n      if ((0, utils_1.isZeroAddress)(guardAddress)) {\n        throw new Error('There is no guard enabled yet');\n      }\n    }\n  }, {\n    key: \"getGuard\",\n    value: function () {\n      var _getGuard = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var safeVersion;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return __classPrivateFieldGet(this, _GuardManager_safeContract, \"f\").getVersion();\n\n              case 2:\n                safeVersion = _context.sent;\n\n                if (!(0, safeVersions_1.hasFeature)(safeVersions_1.FEATURES.SAFE_TX_GUARDS, safeVersion)) {\n                  _context.next = 7;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", __classPrivateFieldGet(this, _GuardManager_ethAdapter, \"f\").getStorageAt(__classPrivateFieldGet(this, _GuardManager_safeContract, \"f\").getAddress(), __classPrivateFieldGet(this, _GuardManager_slot, \"f\")));\n\n              case 7:\n                throw new Error('Current version of the Safe does not support Safe transaction guards functionality');\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getGuard() {\n        return _getGuard.apply(this, arguments);\n      }\n\n      return getGuard;\n    }()\n  }, {\n    key: \"encodeEnableGuardData\",\n    value: function () {\n      var _encodeEnableGuardData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(guardAddress) {\n        var currentGuard;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.validateGuardAddress(guardAddress);\n                _context2.next = 3;\n                return this.getGuard();\n\n              case 3:\n                currentGuard = _context2.sent;\n                this.validateGuardIsNotEnabled(currentGuard, guardAddress);\n                return _context2.abrupt(\"return\", __classPrivateFieldGet(this, _GuardManager_safeContract, \"f\").encode('setGuard', [guardAddress]));\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function encodeEnableGuardData(_x) {\n        return _encodeEnableGuardData.apply(this, arguments);\n      }\n\n      return encodeEnableGuardData;\n    }()\n  }, {\n    key: \"encodeDisableGuardData\",\n    value: function () {\n      var _encodeDisableGuardData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var currentGuard;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return this.getGuard();\n\n              case 2:\n                currentGuard = _context3.sent;\n                this.validateGuardIsEnabled(currentGuard);\n                return _context3.abrupt(\"return\", __classPrivateFieldGet(this, _GuardManager_safeContract, \"f\").encode('setGuard', [constants_1.ZERO_ADDRESS]));\n\n              case 5:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function encodeDisableGuardData() {\n        return _encodeDisableGuardData.apply(this, arguments);\n      }\n\n      return encodeDisableGuardData;\n    }()\n  }]);\n\n  return GuardManager;\n}();\n\n_GuardManager_ethAdapter = new WeakMap(), _GuardManager_safeContract = new WeakMap(), _GuardManager_slot = new WeakMap();\nexports.default = GuardManager;","map":{"version":3,"sources":["../../../src/managers/guardManager.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _GuardManager_ethAdapter, _GuardManager_safeContract, _GuardManager_slot;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst utils_1 = require(\"../utils\");\nconst constants_1 = require(\"../utils/constants\");\nconst safeVersions_1 = require(\"../utils/safeVersions\");\nclass GuardManager {\n    constructor(ethAdapter, safeContract) {\n        _GuardManager_ethAdapter.set(this, void 0);\n        _GuardManager_safeContract.set(this, void 0);\n        // keccak256(\"guard_manager.guard.address\")\n        _GuardManager_slot.set(this, '0x4a204f620c8c5ccdca3fd54d003badd85ba500436a431f0cbda4f558c93c34c8');\n        __classPrivateFieldSet(this, _GuardManager_ethAdapter, ethAdapter, \"f\");\n        __classPrivateFieldSet(this, _GuardManager_safeContract, safeContract, \"f\");\n    }\n    validateGuardAddress(guardAddress) {\n        const isValidAddress = __classPrivateFieldGet(this, _GuardManager_ethAdapter, \"f\").isAddress(guardAddress);\n        if (!isValidAddress || (0, utils_1.isZeroAddress)(guardAddress)) {\n            throw new Error('Invalid guard address provided');\n        }\n    }\n    validateGuardIsNotEnabled(currentGuard, newGuardAddress) {\n        if ((0, utils_1.sameString)(currentGuard, newGuardAddress)) {\n            throw new Error('Guard provided is already enabled');\n        }\n    }\n    validateGuardIsEnabled(guardAddress) {\n        if ((0, utils_1.isZeroAddress)(guardAddress)) {\n            throw new Error('There is no guard enabled yet');\n        }\n    }\n    async getGuard() {\n        const safeVersion = await __classPrivateFieldGet(this, _GuardManager_safeContract, \"f\").getVersion();\n        if ((0, safeVersions_1.hasFeature)(safeVersions_1.FEATURES.SAFE_TX_GUARDS, safeVersion)) {\n            return __classPrivateFieldGet(this, _GuardManager_ethAdapter, \"f\").getStorageAt(__classPrivateFieldGet(this, _GuardManager_safeContract, \"f\").getAddress(), __classPrivateFieldGet(this, _GuardManager_slot, \"f\"));\n        }\n        else {\n            throw new Error('Current version of the Safe does not support Safe transaction guards functionality');\n        }\n    }\n    async encodeEnableGuardData(guardAddress) {\n        this.validateGuardAddress(guardAddress);\n        const currentGuard = await this.getGuard();\n        this.validateGuardIsNotEnabled(currentGuard, guardAddress);\n        return __classPrivateFieldGet(this, _GuardManager_safeContract, \"f\").encode('setGuard', [guardAddress]);\n    }\n    async encodeDisableGuardData() {\n        const currentGuard = await this.getGuard();\n        this.validateGuardIsEnabled(currentGuard);\n        return __classPrivateFieldGet(this, _GuardManager_safeContract, \"f\").encode('setGuard', [constants_1.ZERO_ADDRESS]);\n    }\n}\n_GuardManager_ethAdapter = new WeakMap(), _GuardManager_safeContract = new WeakMap(), _GuardManager_slot = new WeakMap();\nexports.default = GuardManager;\n//# sourceMappingURL=guardManager.js.map"]},"metadata":{},"sourceType":"script"}