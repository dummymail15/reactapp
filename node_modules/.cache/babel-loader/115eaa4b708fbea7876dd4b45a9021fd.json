{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.encodeMultiSendData = exports.standardizeSafeTransactionData = exports.standardizeMetaTransactionData = void 0;\n\nconst bytes_1 = require(\"@ethersproject/bytes\");\n\nconst solidity_1 = require(\"@ethersproject/solidity\");\n\nconst safe_core_sdk_types_1 = require(\"@safe-global/safe-core-sdk-types\");\n\nconst constants_1 = require(\"../constants\");\n\nconst safeVersions_1 = require(\"../safeVersions\");\n\nconst gas_1 = require(\"./gas\");\n\nfunction standardizeMetaTransactionData(tx) {\n  var _a;\n\n  const standardizedTxs = { ...tx,\n    operation: (_a = tx.operation) !== null && _a !== void 0 ? _a : safe_core_sdk_types_1.OperationType.Call\n  };\n  return standardizedTxs;\n}\n\nexports.standardizeMetaTransactionData = standardizeMetaTransactionData;\n\nasync function standardizeSafeTransactionData(safeContract, ethAdapter, tx) {\n  var _a, _b, _c, _d;\n\n  const standardizedTxs = {\n    to: tx.to,\n    value: tx.value,\n    data: tx.data,\n    operation: (_a = tx.operation) !== null && _a !== void 0 ? _a : safe_core_sdk_types_1.OperationType.Call,\n    baseGas: (_b = tx.baseGas) !== null && _b !== void 0 ? _b : 0,\n    gasPrice: (_c = tx.gasPrice) !== null && _c !== void 0 ? _c : 0,\n    gasToken: tx.gasToken || constants_1.ZERO_ADDRESS,\n    refundReceiver: tx.refundReceiver || constants_1.ZERO_ADDRESS,\n    nonce: (_d = tx.nonce) !== null && _d !== void 0 ? _d : await safeContract.getNonce()\n  };\n  let safeTxGas;\n\n  if (typeof tx.safeTxGas !== 'undefined') {\n    return { ...standardizedTxs,\n      safeTxGas: tx.safeTxGas\n    };\n  }\n\n  const safeVersion = await safeContract.getVersion();\n\n  if ((0, safeVersions_1.hasFeature)(safeVersions_1.FEATURES.SAFE_TX_GAS_OPTIONAL, safeVersion) && standardizedTxs.gasPrice === 0) {\n    safeTxGas = 0;\n  } else {\n    safeTxGas = await (0, gas_1.estimateTxGas)(safeContract, ethAdapter, standardizedTxs.to, standardizedTxs.value, standardizedTxs.data, standardizedTxs.operation);\n  }\n\n  return { ...standardizedTxs,\n    safeTxGas\n  };\n}\n\nexports.standardizeSafeTransactionData = standardizeSafeTransactionData;\n\nfunction encodeMetaTransaction(tx) {\n  const data = (0, bytes_1.arrayify)(tx.data);\n  const encoded = (0, solidity_1.pack)(['uint8', 'address', 'uint256', 'uint256', 'bytes'], [tx.operation, tx.to, tx.value, data.length, data]);\n  return encoded.slice(2);\n}\n\nfunction encodeMultiSendData(txs) {\n  return '0x' + txs.map(tx => encodeMetaTransaction(tx)).join('');\n}\n\nexports.encodeMultiSendData = encodeMultiSendData;","map":{"version":3,"sources":["../../../../src/utils/transactions/utils.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.encodeMultiSendData = exports.standardizeSafeTransactionData = exports.standardizeMetaTransactionData = void 0;\nconst bytes_1 = require(\"@ethersproject/bytes\");\nconst solidity_1 = require(\"@ethersproject/solidity\");\nconst safe_core_sdk_types_1 = require(\"@safe-global/safe-core-sdk-types\");\nconst constants_1 = require(\"../constants\");\nconst safeVersions_1 = require(\"../safeVersions\");\nconst gas_1 = require(\"./gas\");\nfunction standardizeMetaTransactionData(tx) {\n    var _a;\n    const standardizedTxs = {\n        ...tx,\n        operation: (_a = tx.operation) !== null && _a !== void 0 ? _a : safe_core_sdk_types_1.OperationType.Call\n    };\n    return standardizedTxs;\n}\nexports.standardizeMetaTransactionData = standardizeMetaTransactionData;\nasync function standardizeSafeTransactionData(safeContract, ethAdapter, tx) {\n    var _a, _b, _c, _d;\n    const standardizedTxs = {\n        to: tx.to,\n        value: tx.value,\n        data: tx.data,\n        operation: (_a = tx.operation) !== null && _a !== void 0 ? _a : safe_core_sdk_types_1.OperationType.Call,\n        baseGas: (_b = tx.baseGas) !== null && _b !== void 0 ? _b : 0,\n        gasPrice: (_c = tx.gasPrice) !== null && _c !== void 0 ? _c : 0,\n        gasToken: tx.gasToken || constants_1.ZERO_ADDRESS,\n        refundReceiver: tx.refundReceiver || constants_1.ZERO_ADDRESS,\n        nonce: (_d = tx.nonce) !== null && _d !== void 0 ? _d : (await safeContract.getNonce())\n    };\n    let safeTxGas;\n    if (typeof tx.safeTxGas !== 'undefined') {\n        return {\n            ...standardizedTxs,\n            safeTxGas: tx.safeTxGas\n        };\n    }\n    const safeVersion = await safeContract.getVersion();\n    if ((0, safeVersions_1.hasFeature)(safeVersions_1.FEATURES.SAFE_TX_GAS_OPTIONAL, safeVersion) && standardizedTxs.gasPrice === 0) {\n        safeTxGas = 0;\n    }\n    else {\n        safeTxGas = await (0, gas_1.estimateTxGas)(safeContract, ethAdapter, standardizedTxs.to, standardizedTxs.value, standardizedTxs.data, standardizedTxs.operation);\n    }\n    return {\n        ...standardizedTxs,\n        safeTxGas\n    };\n}\nexports.standardizeSafeTransactionData = standardizeSafeTransactionData;\nfunction encodeMetaTransaction(tx) {\n    const data = (0, bytes_1.arrayify)(tx.data);\n    const encoded = (0, solidity_1.pack)(['uint8', 'address', 'uint256', 'uint256', 'bytes'], [tx.operation, tx.to, tx.value, data.length, data]);\n    return encoded.slice(2);\n}\nfunction encodeMultiSendData(txs) {\n    return '0x' + txs.map((tx) => encodeMetaTransaction(tx)).join('');\n}\nexports.encodeMultiSendData = encodeMultiSendData;\n//# sourceMappingURL=utils.js.map"]},"metadata":{},"sourceType":"script"}