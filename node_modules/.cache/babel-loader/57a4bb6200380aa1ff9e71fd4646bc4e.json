{"ast":null,"code":"\"use strict\";\n\nvar _objectSpread = require(\"/home/ravi/coinflip/coin-flip-test-main/node_modules/@babel/runtime/helpers/objectSpread2\");\n\nvar _regeneratorRuntime = require(\"/home/ravi/coinflip/coin-flip-test-main/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/home/ravi/coinflip/coin-flip-test-main/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _classCallCheck = require(\"/home/ravi/coinflip/coin-flip-test-main/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/home/ravi/coinflip/coin-flip-test-main/node_modules/@babel/runtime/helpers/createClass\");\n\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\n\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nvar _SafeFactory_contractNetworks, _SafeFactory_isL1SafeMasterCopy, _SafeFactory_safeVersion, _SafeFactory_ethAdapter, _SafeFactory_safeProxyFactoryContract, _SafeFactory_gnosisSafeContract;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar ethereumjs_util_1 = require(\"ethereumjs-util\");\n\nvar config_1 = require(\"../contracts/config\");\n\nvar safeDeploymentContracts_1 = require(\"../contracts/safeDeploymentContracts\");\n\nvar Safe_1 = __importDefault(require(\"../Safe\"));\n\nvar constants_1 = require(\"../utils/constants\");\n\nvar utils_1 = require(\"./utils\");\n\nvar SafeFactory = /*#__PURE__*/function () {\n  function SafeFactory() {\n    _classCallCheck(this, SafeFactory);\n\n    _SafeFactory_contractNetworks.set(this, void 0);\n\n    _SafeFactory_isL1SafeMasterCopy.set(this, void 0);\n\n    _SafeFactory_safeVersion.set(this, void 0);\n\n    _SafeFactory_ethAdapter.set(this, void 0);\n\n    _SafeFactory_safeProxyFactoryContract.set(this, void 0);\n\n    _SafeFactory_gnosisSafeContract.set(this, void 0);\n  }\n\n  _createClass(SafeFactory, [{\n    key: \"init\",\n    value: function () {\n      var _init = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n        var ethAdapter, safeVersion, isL1SafeMasterCopy, contractNetworks, chainId, customContracts;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                ethAdapter = _ref.ethAdapter, safeVersion = _ref.safeVersion, isL1SafeMasterCopy = _ref.isL1SafeMasterCopy, contractNetworks = _ref.contractNetworks;\n\n                __classPrivateFieldSet(this, _SafeFactory_ethAdapter, ethAdapter, \"f\");\n\n                __classPrivateFieldSet(this, _SafeFactory_safeVersion, safeVersion, \"f\");\n\n                __classPrivateFieldSet(this, _SafeFactory_isL1SafeMasterCopy, isL1SafeMasterCopy, \"f\");\n\n                __classPrivateFieldSet(this, _SafeFactory_contractNetworks, contractNetworks, \"f\");\n\n                _context.next = 7;\n                return __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\").getChainId();\n\n              case 7:\n                chainId = _context.sent;\n                customContracts = contractNetworks === null || contractNetworks === void 0 ? void 0 : contractNetworks[chainId];\n                _context.t0 = __classPrivateFieldSet;\n                _context.t1 = this;\n                _context.t2 = _SafeFactory_safeProxyFactoryContract;\n                _context.next = 14;\n                return (0, safeDeploymentContracts_1.getProxyFactoryContract)({\n                  ethAdapter: ethAdapter,\n                  safeVersion: safeVersion,\n                  chainId: chainId,\n                  customContracts: customContracts\n                });\n\n              case 14:\n                _context.t3 = _context.sent;\n                (0, _context.t0)(_context.t1, _context.t2, _context.t3, \"f\");\n                _context.t4 = __classPrivateFieldSet;\n                _context.t5 = this;\n                _context.t6 = _SafeFactory_gnosisSafeContract;\n                _context.next = 21;\n                return (0, safeDeploymentContracts_1.getSafeContract)({\n                  ethAdapter: ethAdapter,\n                  safeVersion: safeVersion,\n                  chainId: chainId,\n                  isL1SafeMasterCopy: isL1SafeMasterCopy,\n                  customContracts: customContracts\n                });\n\n              case 21:\n                _context.t7 = _context.sent;\n                (0, _context.t4)(_context.t5, _context.t6, _context.t7, \"f\");\n\n              case 23:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function init(_x) {\n        return _init.apply(this, arguments);\n      }\n\n      return init;\n    }()\n  }, {\n    key: \"getEthAdapter\",\n    value: function getEthAdapter() {\n      return __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\");\n    }\n  }, {\n    key: \"getSafeVersion\",\n    value: function getSafeVersion() {\n      return __classPrivateFieldGet(this, _SafeFactory_safeVersion, \"f\");\n    }\n  }, {\n    key: \"getAddress\",\n    value: function getAddress() {\n      return __classPrivateFieldGet(this, _SafeFactory_safeProxyFactoryContract, \"f\").getAddress();\n    }\n  }, {\n    key: \"getChainId\",\n    value: function () {\n      var _getChainId = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.abrupt(\"return\", __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\").getChainId());\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getChainId() {\n        return _getChainId.apply(this, arguments);\n      }\n\n      return getChainId;\n    }()\n  }, {\n    key: \"encodeSetupCallData\",\n    value: function () {\n      var _encodeSetupCallData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref2) {\n        var owners, threshold, _ref2$to, to, _ref2$data, data, fallbackHandler, _ref2$paymentToken, paymentToken, _ref2$payment, payment, _ref2$paymentReceiver, paymentReceiver, _a, fallbackHandlerAddress, chainId, customContracts, fallbackHandlerContract;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                owners = _ref2.owners, threshold = _ref2.threshold, _ref2$to = _ref2.to, to = _ref2$to === void 0 ? constants_1.ZERO_ADDRESS : _ref2$to, _ref2$data = _ref2.data, data = _ref2$data === void 0 ? constants_1.EMPTY_DATA : _ref2$data, fallbackHandler = _ref2.fallbackHandler, _ref2$paymentToken = _ref2.paymentToken, paymentToken = _ref2$paymentToken === void 0 ? constants_1.ZERO_ADDRESS : _ref2$paymentToken, _ref2$payment = _ref2.payment, payment = _ref2$payment === void 0 ? 0 : _ref2$payment, _ref2$paymentReceiver = _ref2.paymentReceiver, paymentReceiver = _ref2$paymentReceiver === void 0 ? constants_1.ZERO_ADDRESS : _ref2$paymentReceiver;\n\n                if (!fallbackHandler) {\n                  _context3.next = 5;\n                  break;\n                }\n\n                fallbackHandlerAddress = fallbackHandler;\n                _context3.next = 13;\n                break;\n\n              case 5:\n                _context3.next = 7;\n                return __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\").getChainId();\n\n              case 7:\n                chainId = _context3.sent;\n                customContracts = (_a = __classPrivateFieldGet(this, _SafeFactory_contractNetworks, \"f\")) === null || _a === void 0 ? void 0 : _a[chainId];\n                _context3.next = 11;\n                return (0, safeDeploymentContracts_1.getCompatibilityFallbackHandlerContract)({\n                  ethAdapter: __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\"),\n                  safeVersion: __classPrivateFieldGet(this, _SafeFactory_safeVersion, \"f\"),\n                  chainId: chainId,\n                  customContracts: customContracts\n                });\n\n              case 11:\n                fallbackHandlerContract = _context3.sent;\n                fallbackHandlerAddress = fallbackHandlerContract.getAddress();\n\n              case 13:\n                return _context3.abrupt(\"return\", __classPrivateFieldGet(this, _SafeFactory_gnosisSafeContract, \"f\").encode('setup', [owners, threshold, to, data, fallbackHandlerAddress, paymentToken, payment, paymentReceiver]));\n\n              case 14:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function encodeSetupCallData(_x2) {\n        return _encodeSetupCallData.apply(this, arguments);\n      }\n\n      return encodeSetupCallData;\n    }()\n  }, {\n    key: \"predictSafeAddress\",\n    value: function () {\n      var _predictSafeAddress = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(_ref3) {\n        var safeAccountConfig, safeDeploymentConfig, from, initializer, saltNonce, encodedNonce, salt, proxyCreationCode, constructorData, initCode, proxyAddress;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                safeAccountConfig = _ref3.safeAccountConfig, safeDeploymentConfig = _ref3.safeDeploymentConfig;\n                (0, utils_1.validateSafeAccountConfig)(safeAccountConfig);\n                (0, utils_1.validateSafeDeploymentConfig)(safeDeploymentConfig);\n                from = __classPrivateFieldGet(this, _SafeFactory_safeProxyFactoryContract, \"f\").getAddress();\n                _context4.next = 6;\n                return this.encodeSetupCallData(safeAccountConfig);\n\n              case 6:\n                initializer = _context4.sent;\n                saltNonce = safeDeploymentConfig.saltNonce;\n                encodedNonce = (0, ethereumjs_util_1.toBuffer)(__classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\").encodeParameters(['uint256'], [saltNonce])).toString('hex');\n                salt = (0, ethereumjs_util_1.keccak256)((0, ethereumjs_util_1.toBuffer)('0x' + (0, ethereumjs_util_1.keccak256)((0, ethereumjs_util_1.toBuffer)(initializer)).toString('hex') + encodedNonce));\n                _context4.next = 12;\n                return __classPrivateFieldGet(this, _SafeFactory_safeProxyFactoryContract, \"f\").proxyCreationCode();\n\n              case 12:\n                proxyCreationCode = _context4.sent;\n                constructorData = (0, ethereumjs_util_1.toBuffer)(__classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\").encodeParameters(['address'], [__classPrivateFieldGet(this, _SafeFactory_gnosisSafeContract, \"f\").getAddress()])).toString('hex');\n                initCode = proxyCreationCode + constructorData;\n                proxyAddress = '0x' + (0, ethereumjs_util_1.generateAddress2)((0, ethereumjs_util_1.toBuffer)(from), (0, ethereumjs_util_1.toBuffer)(salt), (0, ethereumjs_util_1.toBuffer)(initCode)).toString('hex');\n                return _context4.abrupt(\"return\", __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\").getChecksummedAddress(proxyAddress));\n\n              case 17:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function predictSafeAddress(_x3) {\n        return _predictSafeAddress.apply(this, arguments);\n      }\n\n      return predictSafeAddress;\n    }()\n  }, {\n    key: \"deploySafe\",\n    value: function () {\n      var _deploySafe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(_ref4) {\n        var safeAccountConfig, safeDeploymentConfig, options, callback, _a, signerAddress, initializer, saltNonce, safeAddress, isContractDeployed, safe;\n\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                safeAccountConfig = _ref4.safeAccountConfig, safeDeploymentConfig = _ref4.safeDeploymentConfig, options = _ref4.options, callback = _ref4.callback;\n                (0, utils_1.validateSafeAccountConfig)(safeAccountConfig);\n\n                if (safeDeploymentConfig) {\n                  (0, utils_1.validateSafeDeploymentConfig)(safeDeploymentConfig);\n                }\n\n                _context5.next = 5;\n                return __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\").getSignerAddress();\n\n              case 5:\n                signerAddress = _context5.sent;\n\n                if (signerAddress) {\n                  _context5.next = 8;\n                  break;\n                }\n\n                throw new Error('EthAdapter must be initialized with a signer to use this method');\n\n              case 8:\n                _context5.next = 10;\n                return this.encodeSetupCallData(safeAccountConfig);\n\n              case 10:\n                initializer = _context5.sent;\n                saltNonce = (_a = safeDeploymentConfig === null || safeDeploymentConfig === void 0 ? void 0 : safeDeploymentConfig.saltNonce) !== null && _a !== void 0 ? _a : (Date.now() * 1000 + Math.floor(Math.random() * 1000)).toString();\n\n                if (!((options === null || options === void 0 ? void 0 : options.gas) && (options === null || options === void 0 ? void 0 : options.gasLimit))) {\n                  _context5.next = 14;\n                  break;\n                }\n\n                throw new Error('Cannot specify gas and gasLimit together in transaction options');\n\n              case 14:\n                _context5.next = 16;\n                return __classPrivateFieldGet(this, _SafeFactory_safeProxyFactoryContract, \"f\").createProxy({\n                  safeMasterCopyAddress: __classPrivateFieldGet(this, _SafeFactory_gnosisSafeContract, \"f\").getAddress(),\n                  initializer: initializer,\n                  saltNonce: saltNonce,\n                  options: _objectSpread({\n                    from: signerAddress\n                  }, options),\n                  callback: callback\n                });\n\n              case 16:\n                safeAddress = _context5.sent;\n                _context5.next = 19;\n                return __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\").isContractDeployed(safeAddress);\n\n              case 19:\n                isContractDeployed = _context5.sent;\n\n                if (isContractDeployed) {\n                  _context5.next = 22;\n                  break;\n                }\n\n                throw new Error('SafeProxy contract is not deployed on the current network');\n\n              case 22:\n                _context5.next = 24;\n                return Safe_1.default.create({\n                  ethAdapter: __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\"),\n                  safeAddress: safeAddress,\n                  isL1SafeMasterCopy: __classPrivateFieldGet(this, _SafeFactory_isL1SafeMasterCopy, \"f\"),\n                  contractNetworks: __classPrivateFieldGet(this, _SafeFactory_contractNetworks, \"f\")\n                });\n\n              case 24:\n                safe = _context5.sent;\n                return _context5.abrupt(\"return\", safe);\n\n              case 26:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function deploySafe(_x4) {\n        return _deploySafe.apply(this, arguments);\n      }\n\n      return deploySafe;\n    }()\n  }], [{\n    key: \"create\",\n    value: function () {\n      var _create = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(_ref5) {\n        var ethAdapter, _ref5$safeVersion, safeVersion, _ref5$isL1SafeMasterC, isL1SafeMasterCopy, contractNetworks, safeFactorySdk;\n\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                ethAdapter = _ref5.ethAdapter, _ref5$safeVersion = _ref5.safeVersion, safeVersion = _ref5$safeVersion === void 0 ? config_1.SAFE_LAST_VERSION : _ref5$safeVersion, _ref5$isL1SafeMasterC = _ref5.isL1SafeMasterCopy, isL1SafeMasterCopy = _ref5$isL1SafeMasterC === void 0 ? false : _ref5$isL1SafeMasterC, contractNetworks = _ref5.contractNetworks;\n                safeFactorySdk = new SafeFactory();\n                _context6.next = 4;\n                return safeFactorySdk.init({\n                  ethAdapter: ethAdapter,\n                  safeVersion: safeVersion,\n                  isL1SafeMasterCopy: isL1SafeMasterCopy,\n                  contractNetworks: contractNetworks\n                });\n\n              case 4:\n                return _context6.abrupt(\"return\", safeFactorySdk);\n\n              case 5:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6);\n      }));\n\n      function create(_x5) {\n        return _create.apply(this, arguments);\n      }\n\n      return create;\n    }()\n  }]);\n\n  return SafeFactory;\n}();\n\n_SafeFactory_contractNetworks = new WeakMap(), _SafeFactory_isL1SafeMasterCopy = new WeakMap(), _SafeFactory_safeVersion = new WeakMap(), _SafeFactory_ethAdapter = new WeakMap(), _SafeFactory_safeProxyFactoryContract = new WeakMap(), _SafeFactory_gnosisSafeContract = new WeakMap();\nexports.default = SafeFactory;","map":{"version":3,"sources":["../../../src/safeFactory/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nvar _SafeFactory_contractNetworks, _SafeFactory_isL1SafeMasterCopy, _SafeFactory_safeVersion, _SafeFactory_ethAdapter, _SafeFactory_safeProxyFactoryContract, _SafeFactory_gnosisSafeContract;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst ethereumjs_util_1 = require(\"ethereumjs-util\");\nconst config_1 = require(\"../contracts/config\");\nconst safeDeploymentContracts_1 = require(\"../contracts/safeDeploymentContracts\");\nconst Safe_1 = __importDefault(require(\"../Safe\"));\nconst constants_1 = require(\"../utils/constants\");\nconst utils_1 = require(\"./utils\");\nclass SafeFactory {\n    constructor() {\n        _SafeFactory_contractNetworks.set(this, void 0);\n        _SafeFactory_isL1SafeMasterCopy.set(this, void 0);\n        _SafeFactory_safeVersion.set(this, void 0);\n        _SafeFactory_ethAdapter.set(this, void 0);\n        _SafeFactory_safeProxyFactoryContract.set(this, void 0);\n        _SafeFactory_gnosisSafeContract.set(this, void 0);\n    }\n    static async create({ ethAdapter, safeVersion = config_1.SAFE_LAST_VERSION, isL1SafeMasterCopy = false, contractNetworks }) {\n        const safeFactorySdk = new SafeFactory();\n        await safeFactorySdk.init({ ethAdapter, safeVersion, isL1SafeMasterCopy, contractNetworks });\n        return safeFactorySdk;\n    }\n    async init({ ethAdapter, safeVersion, isL1SafeMasterCopy, contractNetworks }) {\n        __classPrivateFieldSet(this, _SafeFactory_ethAdapter, ethAdapter, \"f\");\n        __classPrivateFieldSet(this, _SafeFactory_safeVersion, safeVersion, \"f\");\n        __classPrivateFieldSet(this, _SafeFactory_isL1SafeMasterCopy, isL1SafeMasterCopy, \"f\");\n        __classPrivateFieldSet(this, _SafeFactory_contractNetworks, contractNetworks, \"f\");\n        const chainId = await __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\").getChainId();\n        const customContracts = contractNetworks === null || contractNetworks === void 0 ? void 0 : contractNetworks[chainId];\n        __classPrivateFieldSet(this, _SafeFactory_safeProxyFactoryContract, await (0, safeDeploymentContracts_1.getProxyFactoryContract)({\n            ethAdapter,\n            safeVersion,\n            chainId,\n            customContracts\n        }), \"f\");\n        __classPrivateFieldSet(this, _SafeFactory_gnosisSafeContract, await (0, safeDeploymentContracts_1.getSafeContract)({\n            ethAdapter,\n            safeVersion,\n            chainId,\n            isL1SafeMasterCopy,\n            customContracts\n        }), \"f\");\n    }\n    getEthAdapter() {\n        return __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\");\n    }\n    getSafeVersion() {\n        return __classPrivateFieldGet(this, _SafeFactory_safeVersion, \"f\");\n    }\n    getAddress() {\n        return __classPrivateFieldGet(this, _SafeFactory_safeProxyFactoryContract, \"f\").getAddress();\n    }\n    async getChainId() {\n        return __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\").getChainId();\n    }\n    async encodeSetupCallData({ owners, threshold, to = constants_1.ZERO_ADDRESS, data = constants_1.EMPTY_DATA, fallbackHandler, paymentToken = constants_1.ZERO_ADDRESS, payment = 0, paymentReceiver = constants_1.ZERO_ADDRESS }) {\n        var _a;\n        let fallbackHandlerAddress;\n        if (fallbackHandler) {\n            fallbackHandlerAddress = fallbackHandler;\n        }\n        else {\n            const chainId = await __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\").getChainId();\n            const customContracts = (_a = __classPrivateFieldGet(this, _SafeFactory_contractNetworks, \"f\")) === null || _a === void 0 ? void 0 : _a[chainId];\n            const fallbackHandlerContract = await (0, safeDeploymentContracts_1.getCompatibilityFallbackHandlerContract)({\n                ethAdapter: __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\"),\n                safeVersion: __classPrivateFieldGet(this, _SafeFactory_safeVersion, \"f\"),\n                chainId,\n                customContracts\n            });\n            fallbackHandlerAddress = fallbackHandlerContract.getAddress();\n        }\n        return __classPrivateFieldGet(this, _SafeFactory_gnosisSafeContract, \"f\").encode('setup', [\n            owners,\n            threshold,\n            to,\n            data,\n            fallbackHandlerAddress,\n            paymentToken,\n            payment,\n            paymentReceiver\n        ]);\n    }\n    async predictSafeAddress({ safeAccountConfig, safeDeploymentConfig }) {\n        (0, utils_1.validateSafeAccountConfig)(safeAccountConfig);\n        (0, utils_1.validateSafeDeploymentConfig)(safeDeploymentConfig);\n        const from = __classPrivateFieldGet(this, _SafeFactory_safeProxyFactoryContract, \"f\").getAddress();\n        const initializer = await this.encodeSetupCallData(safeAccountConfig);\n        const saltNonce = safeDeploymentConfig.saltNonce;\n        const encodedNonce = (0, ethereumjs_util_1.toBuffer)(__classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\").encodeParameters(['uint256'], [saltNonce])).toString('hex');\n        const salt = (0, ethereumjs_util_1.keccak256)((0, ethereumjs_util_1.toBuffer)('0x' + (0, ethereumjs_util_1.keccak256)((0, ethereumjs_util_1.toBuffer)(initializer)).toString('hex') + encodedNonce));\n        const proxyCreationCode = await __classPrivateFieldGet(this, _SafeFactory_safeProxyFactoryContract, \"f\").proxyCreationCode();\n        const constructorData = (0, ethereumjs_util_1.toBuffer)(__classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\").encodeParameters(['address'], [__classPrivateFieldGet(this, _SafeFactory_gnosisSafeContract, \"f\").getAddress()])).toString('hex');\n        const initCode = proxyCreationCode + constructorData;\n        const proxyAddress = '0x' + (0, ethereumjs_util_1.generateAddress2)((0, ethereumjs_util_1.toBuffer)(from), (0, ethereumjs_util_1.toBuffer)(salt), (0, ethereumjs_util_1.toBuffer)(initCode)).toString('hex');\n        return __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\").getChecksummedAddress(proxyAddress);\n    }\n    async deploySafe({ safeAccountConfig, safeDeploymentConfig, options, callback }) {\n        var _a;\n        (0, utils_1.validateSafeAccountConfig)(safeAccountConfig);\n        if (safeDeploymentConfig) {\n            (0, utils_1.validateSafeDeploymentConfig)(safeDeploymentConfig);\n        }\n        const signerAddress = await __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\").getSignerAddress();\n        if (!signerAddress) {\n            throw new Error('EthAdapter must be initialized with a signer to use this method');\n        }\n        const initializer = await this.encodeSetupCallData(safeAccountConfig);\n        const saltNonce = (_a = safeDeploymentConfig === null || safeDeploymentConfig === void 0 ? void 0 : safeDeploymentConfig.saltNonce) !== null && _a !== void 0 ? _a : (Date.now() * 1000 + Math.floor(Math.random() * 1000)).toString();\n        if ((options === null || options === void 0 ? void 0 : options.gas) && (options === null || options === void 0 ? void 0 : options.gasLimit)) {\n            throw new Error('Cannot specify gas and gasLimit together in transaction options');\n        }\n        const safeAddress = await __classPrivateFieldGet(this, _SafeFactory_safeProxyFactoryContract, \"f\").createProxy({\n            safeMasterCopyAddress: __classPrivateFieldGet(this, _SafeFactory_gnosisSafeContract, \"f\").getAddress(),\n            initializer,\n            saltNonce,\n            options: {\n                from: signerAddress,\n                ...options\n            },\n            callback\n        });\n        const isContractDeployed = await __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\").isContractDeployed(safeAddress);\n        if (!isContractDeployed) {\n            throw new Error('SafeProxy contract is not deployed on the current network');\n        }\n        const safe = await Safe_1.default.create({\n            ethAdapter: __classPrivateFieldGet(this, _SafeFactory_ethAdapter, \"f\"),\n            safeAddress,\n            isL1SafeMasterCopy: __classPrivateFieldGet(this, _SafeFactory_isL1SafeMasterCopy, \"f\"),\n            contractNetworks: __classPrivateFieldGet(this, _SafeFactory_contractNetworks, \"f\")\n        });\n        return safe;\n    }\n}\n_SafeFactory_contractNetworks = new WeakMap(), _SafeFactory_isL1SafeMasterCopy = new WeakMap(), _SafeFactory_safeVersion = new WeakMap(), _SafeFactory_ethAdapter = new WeakMap(), _SafeFactory_safeProxyFactoryContract = new WeakMap(), _SafeFactory_gnosisSafeContract = new WeakMap();\nexports.default = SafeFactory;\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}