{"ast":null,"code":"\"use strict\";\n\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\n\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\n\nvar _FallbackHandlerManager_ethAdapter, _FallbackHandlerManager_safeContract, _FallbackHandlerManager_slot;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst utils_1 = require(\"../utils\");\n\nconst constants_1 = require(\"../utils/constants\");\n\nconst safeVersions_1 = require(\"../utils/safeVersions\");\n\nclass FallbackHandlerManager {\n  constructor(ethAdapter, safeContract) {\n    _FallbackHandlerManager_ethAdapter.set(this, void 0);\n\n    _FallbackHandlerManager_safeContract.set(this, void 0); // keccak256(\"fallback_manager.handler.address\")\n\n\n    _FallbackHandlerManager_slot.set(this, '0x6c9a6c4a39284e37ed1cf53d337577d14212a4870fb976a4366c693b939918d5');\n\n    __classPrivateFieldSet(this, _FallbackHandlerManager_ethAdapter, ethAdapter, \"f\");\n\n    __classPrivateFieldSet(this, _FallbackHandlerManager_safeContract, safeContract, \"f\");\n  }\n\n  validateFallbackHandlerAddress(fallbackHandlerAddress) {\n    const isValidAddress = __classPrivateFieldGet(this, _FallbackHandlerManager_ethAdapter, \"f\").isAddress(fallbackHandlerAddress);\n\n    if (!isValidAddress || (0, utils_1.isZeroAddress)(fallbackHandlerAddress)) {\n      throw new Error('Invalid fallback handler address provided');\n    }\n  }\n\n  validateFallbackHandlerIsNotEnabled(currentFallbackHandler, newFallbackHandlerAddress) {\n    if ((0, utils_1.sameString)(currentFallbackHandler, newFallbackHandlerAddress)) {\n      throw new Error('Fallback handler provided is already enabled');\n    }\n  }\n\n  validateFallbackHandlerIsEnabled(fallbackHandlerAddress) {\n    if ((0, utils_1.isZeroAddress)(fallbackHandlerAddress)) {\n      throw new Error('There is no fallback handler enabled yet');\n    }\n  }\n\n  async getFallbackHandler() {\n    const safeVersion = await __classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").getVersion();\n\n    if ((0, safeVersions_1.hasFeature)(safeVersions_1.FEATURES.SAFE_FALLBACK_HANDLER, safeVersion)) {\n      return __classPrivateFieldGet(this, _FallbackHandlerManager_ethAdapter, \"f\").getStorageAt(__classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").getAddress(), __classPrivateFieldGet(this, _FallbackHandlerManager_slot, \"f\"));\n    } else {\n      throw new Error('Current version of the Safe does not support the fallback handler functionality');\n    }\n  }\n\n  async encodeEnableFallbackHandlerData(fallbackHandlerAddress) {\n    this.validateFallbackHandlerAddress(fallbackHandlerAddress);\n    const currentFallbackHandler = await this.getFallbackHandler();\n    this.validateFallbackHandlerIsNotEnabled(currentFallbackHandler, fallbackHandlerAddress);\n    return __classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").encode('setFallbackHandler', [fallbackHandlerAddress]);\n  }\n\n  async encodeDisableFallbackHandlerData() {\n    const currentFallbackHandler = await this.getFallbackHandler();\n    this.validateFallbackHandlerIsEnabled(currentFallbackHandler);\n    return __classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").encode('setFallbackHandler', [constants_1.ZERO_ADDRESS]);\n  }\n\n}\n\n_FallbackHandlerManager_ethAdapter = new WeakMap(), _FallbackHandlerManager_safeContract = new WeakMap(), _FallbackHandlerManager_slot = new WeakMap();\nexports.default = FallbackHandlerManager;","map":{"version":3,"sources":["../../../src/managers/fallbackHandlerManager.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _FallbackHandlerManager_ethAdapter, _FallbackHandlerManager_safeContract, _FallbackHandlerManager_slot;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst utils_1 = require(\"../utils\");\nconst constants_1 = require(\"../utils/constants\");\nconst safeVersions_1 = require(\"../utils/safeVersions\");\nclass FallbackHandlerManager {\n    constructor(ethAdapter, safeContract) {\n        _FallbackHandlerManager_ethAdapter.set(this, void 0);\n        _FallbackHandlerManager_safeContract.set(this, void 0);\n        // keccak256(\"fallback_manager.handler.address\")\n        _FallbackHandlerManager_slot.set(this, '0x6c9a6c4a39284e37ed1cf53d337577d14212a4870fb976a4366c693b939918d5');\n        __classPrivateFieldSet(this, _FallbackHandlerManager_ethAdapter, ethAdapter, \"f\");\n        __classPrivateFieldSet(this, _FallbackHandlerManager_safeContract, safeContract, \"f\");\n    }\n    validateFallbackHandlerAddress(fallbackHandlerAddress) {\n        const isValidAddress = __classPrivateFieldGet(this, _FallbackHandlerManager_ethAdapter, \"f\").isAddress(fallbackHandlerAddress);\n        if (!isValidAddress || (0, utils_1.isZeroAddress)(fallbackHandlerAddress)) {\n            throw new Error('Invalid fallback handler address provided');\n        }\n    }\n    validateFallbackHandlerIsNotEnabled(currentFallbackHandler, newFallbackHandlerAddress) {\n        if ((0, utils_1.sameString)(currentFallbackHandler, newFallbackHandlerAddress)) {\n            throw new Error('Fallback handler provided is already enabled');\n        }\n    }\n    validateFallbackHandlerIsEnabled(fallbackHandlerAddress) {\n        if ((0, utils_1.isZeroAddress)(fallbackHandlerAddress)) {\n            throw new Error('There is no fallback handler enabled yet');\n        }\n    }\n    async getFallbackHandler() {\n        const safeVersion = await __classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").getVersion();\n        if ((0, safeVersions_1.hasFeature)(safeVersions_1.FEATURES.SAFE_FALLBACK_HANDLER, safeVersion)) {\n            return __classPrivateFieldGet(this, _FallbackHandlerManager_ethAdapter, \"f\").getStorageAt(__classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").getAddress(), __classPrivateFieldGet(this, _FallbackHandlerManager_slot, \"f\"));\n        }\n        else {\n            throw new Error('Current version of the Safe does not support the fallback handler functionality');\n        }\n    }\n    async encodeEnableFallbackHandlerData(fallbackHandlerAddress) {\n        this.validateFallbackHandlerAddress(fallbackHandlerAddress);\n        const currentFallbackHandler = await this.getFallbackHandler();\n        this.validateFallbackHandlerIsNotEnabled(currentFallbackHandler, fallbackHandlerAddress);\n        return __classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").encode('setFallbackHandler', [fallbackHandlerAddress]);\n    }\n    async encodeDisableFallbackHandlerData() {\n        const currentFallbackHandler = await this.getFallbackHandler();\n        this.validateFallbackHandlerIsEnabled(currentFallbackHandler);\n        return __classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").encode('setFallbackHandler', [constants_1.ZERO_ADDRESS]);\n    }\n}\n_FallbackHandlerManager_ethAdapter = new WeakMap(), _FallbackHandlerManager_safeContract = new WeakMap(), _FallbackHandlerManager_slot = new WeakMap();\nexports.default = FallbackHandlerManager;\n//# sourceMappingURL=fallbackHandlerManager.js.map"]},"metadata":{},"sourceType":"script"}